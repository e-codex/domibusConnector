//
// this dsl job file creates a folder for the jobs 
// creates a pipelineJob for creating a releaes branch
// creates a multibranchPipelineJob for building each branch
//

folder("WebConnectorFolder") {
	description("Contains Jobs for WebConnector")	
	displayName('WebConnector Jobs')
}

multibranchPipelineJob('WebConnectorFolder/WebConnector') {
	displayName("Web Connector Build Jobs")
    branchSources {
        git {
            remote('https://secure.e-codex.eu/gitblit/r/e-CODEX/WP5/connector.git')
            credentialsId('IT-NRW GIT Repo')
        }
    }
		
    orphanedItemStrategy {
        discardOldItems {
            numToKeep(20)
        }
    }
	
	triggers {
		cron('H H * * *')
	}	
		
}

pipelineJob('WebConnectorFolder/startRelease') {
	description('creates a new release branch from webconnector development branch')
	displayName('start release')

	scm {
	    git {
			branch("development")
            remote {
				url('https://secure.e-codex.eu/gitblit/r/e-CODEX/WP5/connector.git')
				credentials('IT-NRW GIT Repo')
			}
            
			extensions {
				wipeOutWorkspace()
			}
        }
	}
	
	
	definition {
        cps {
            script(readFileFromWorkspace('createrelease'))
            sandbox()
        }
	}
 
	

}
