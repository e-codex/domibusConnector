
ifndef::basepath[]
:basepath: ../../../../
endif::basepath[]

ifndef::header[]
include::{basepath}/doc/header.adoc[]
endif::header[]

ifndef::mvnbasedir[]
:mvnbasedir: {basepath}/../../../../
endif::mvnbasedir[]

= Lookup business domain for message

== Responsibility

* Lookup business domain for message

== Preconditions

* Message exists in DB
* Message has a ConnectorMessageId

== Postconditions

=== GoodCase
* BusinessDomain name is added to message


== Additional Step Properties

* BusinessDomainName

== Activity Diagram

[plantuml,receive_BM_from_gateway_activity,format=svg]
----
@startuml

title Lookup Workflow

start

if (message has refToMessageId) then (yes)
:load business domain of related message;

elseif (message has conversationId) then (yes)
:load business domain of message related by conversationId;

else
:use ruleset;

endif

stop

@enduml
----

== Ruleset

As ruleset the routing rule grammar is used:

[source]
----
include::{mvnbasedir}/domibusConnectorControllerAPI/src/main/java/eu/domibus/connector/controller/routing/RoutingRulePattern.java[tag=BNF]
----

== Notes, Tasks and discussion

* The ruleset must be extended to support LinkPartnerName as routing parameter

|===

| Pros | Cons

| +very flexible approach
| -requires additional configuration compared to a per LinkPartner behaviour

|===


