## CONNECTOR PROPERTIES
##
## This file contains the connector configuration properties
## Properties marked with !! must be changed according to your setup/environment!
##

#debug=true
logging.level.root=INFO

#############################################################################
############################ PROFILES     ###################################
#############################################################################
# defines the by the spring application loaded profiles
#

# BigData Storage profiles:
# storage-db activates the bigFileStorage into database
# storage-fs activates the filesystemStorage
#
# NOTE: only one storage profile at once can be active!
#


# EXPERIMENTAL:
# Setup Wizard Profile:
# setup-wizard activates the setup-wizard profile which checks if the property config wizard version
# matches the version of the connector. If the version does not match the connector starts a minimal
# configuration UI for basic setup [db-connection, property-loading, keystores]
# so the WebUI can start
#
#

#this example stores the data into db connects over webservices to gw and backends
#spring.profiles.active=storage-db,gwlink-ws,backendlink-ws
#this example stores into filesystem connects over webservices to gw and backends
spring.profiles.active=storage-fs,linkplugins,plugin-wsbackendplugin,plugin-wsgatewayplugin,plugin-gwwspullplugin,plugin-gwwspushplugin,plugin-testbackend

#spring.profiles.active=plugin-wsbackendplugin,plugin-wsgatewayplugin,plugin-gwwspullplugin,plugin-gwwspushplugin


#############################################################################
############################ LINK CONFIG  ###################################
#############################################################################

##gateway pull
# connector.link.gateway.link-config.config-name=default
# connector.link.gateway.link-config.link-impl=gwwspullplugin
# connector.link.gateway.link-config.properties.gw-address=http://localhost:8050/domibus/services/dcplugin

# connector.link.gateway.link-config.properties.soap.key-store.path=file:./config/keystores/connector-gwlink-keystore.jks
# connector.link.gateway.link-config.properties.soap.key-store.password=12345
# connector.link.gateway.link-config.properties.soap.private-key.alias=connector
# connector.link.gateway.link-config.properties.soap.private-key.password=12345
# connector.link.gateway.link-config.properties.soap.trust-store.path=file:./config/keystores/connector-gwlink-truststore.jks
# connector.link.gateway.link-config.properties.soap.trust-store.password=12345
# connector.link.gateway.link-config.properties.soap.encrypt-alias=gw
# connector.link.gateway.link-config.properties.cxf-logging-enabled=true
# connector.link.gateway.link-config.properties.ws-policy=classpath:/wsdl/no-security.policy.xml

# connector.link.gateway.link-partners[0].link-partner-name=default_gateway
# connector.link.gateway.link-partners[0].description=test
# connector.link.gateway.link-partners[0].enabled=true
# connector.link.gateway.link-partners[0].pull-interval=30s
# connector.link.gateway.link-partners[0].rcv-link-mode=pull
# connector.link.gateway.link-partners[0].send-link-mode=push

##gateway push
connector.link.gateway.link-config.config-name=default
connector.link.gateway.link-config.link-impl=gwwspushplugin
connector.link.gateway.link-config.properties.gw-address=http://localhost:8050/domibus/services/dcplugin

connector.link.gateway.link-config.properties.soap.key-store.path=file:./config/keystores/connector-gwlink-keystore.jks
connector.link.gateway.link-config.properties.soap.key-store.password=12345
connector.link.gateway.link-config.properties.soap.private-key.alias=connector
connector.link.gateway.link-config.properties.soap.private-key.password=12345
connector.link.gateway.link-config.properties.soap.trust-store.path=file:./config/keystores/connector-gwlink-truststore.jks
connector.link.gateway.link-config.properties.soap.trust-store.password=12345
connector.link.gateway.link-config.properties.soap.encrypt-alias=gw
connector.link.gateway.link-config.properties.cxf-logging-enabled=false
connector.link.gateway.link-config.properties.ws-policy=classpath:/wsdl/no-security.policy.xml
#connector.link.gateway.link-config.properties.ws-policy=classpath:/wsdl/backend.policy.xml

connector.link.gateway.link-partners[0].link-partner-name=default_gateway
connector.link.gateway.link-partners[0].description=test
connector.link.gateway.link-partners[0].enabled=true
connector.link.gateway.link-partners[0].rcv-link-mode=passive
connector.link.gateway.link-partners[0].send-link-mode=push


##backends

# configuration block for the link config itself
connector.link.backend[0].link-config.config-name=default_backend_config
connector.link.backend[0].link-config.link-impl=wsbackendplugin
connector.link.backend[0].link-config.properties.soap.key-store.path=file:config/keystores/connector-backend.jks
connector.link.backend[0].link-config.properties.soap.key-store.password=12345
connector.link.backend[0].link-config.properties.soap.private-key.alias=connector
connector.link.backend[0].link-config.properties.soap.private-key.password=12345
connector.link.backend[0].link-config.properties.soap.trust-store.path=file:config/keystores/connector-backend.jks
connector.link.backend[0].link-config.properties.soap.trust-store.password=12345
connector.link.backend[0].link-config.properties.soap.encrypt-alias=alice


#link partner 0 specific configuration
#the backend name, this name must match any message routing config
#this name will also be stored into the DB to the specific message
connector.link.backend[0].link-partners[0].link-partner-name=backend_bob
#any optional description
connector.link.backend[0].link-partners[0].description=test
#should the linkPartner be enabled
connector.link.backend[0].link-partners[0].enabled=true
#this linkPartner operates in passive mode
# (connector is passive and waits for the backend to pull messages)
connector.link.backend[0].link-partners[0].send-link-mode=passive
#this linkPartner operates in passive mode
# (connector is passive and waits for the backend to push messages)
connector.link.backend[0].link-partners[0].rcv-link-mode=passive
#this must match the certificate alias within the trust-store
connector.link.backend[0].link-partners[0].properties.encryption-alias=bob
#this must match the certificate DN (lower- or UPPERcase is ignored)
connector.link.backend[0].link-partners[0].properties.certificate-dn=cn=bob



#link partner 1 specific configuration
connector.link.backend[0].link-partners[1].link-partner-name=backend_alice
connector.link.backend[0].link-partners[1].description=test
connector.link.backend[0].link-partners[1].enabled=true
#this link partner pushes message to the connector (connector is passive in receive mode)
connector.link.backend[0].link-partners[1].rcv-link-mode=passive
#this linkPartner operates in push mode
# (connector pushes new messages to backend)
connector.link.backend[0].link-partners[1].send-link-mode=push
#this must be the webservice address of the backend client for push mode
#it can be omitted in passive mode
connector.link.backend[0].link-partners[1].properties.push-address=http://localhost:8052/services/domibusConnectorDeliveryWebservice
connector.link.backend[0].link-partners[1].properties.encryption-alias=alice
connector.link.backend[0].link-partners[1].properties.certificate-dn=cn=alice


#config of test backend
#connector.link.backend[1].link-config.config-name=default_test_backend_config
#connector.link.backend[1].link-config.link-impl=testbackend
#connector.link.backend[1].link-partners[0].link-partner-name=default_test_backend
#connector.link.backend[1].link-partners[0].description=the default test backend
#connector.link.backend[1].link-partners[0].enabled=true



################################################################################
############################ CONNECTOR-TESTS ###################################
################################################################################

# Service and action entered here according to the p-modes used.
# Enabled and used messages received with that combination will not be sent to the backend of the connector,
# but will be answered with evidences after processed in the connector.
connector.test.enabled=true

connector.test.service.name=Connector-TEST
connector.test.service.serviceType=urn:e-codex:services:
connector.test.action=Connector-TEST


################################################################################
############################ CONNECTOR-BACKEND-ROUTING #########################
################################################################################
# Routing configuration to which gateway, backend is the message 
# transported?
#

# Is Backend Routing enabled?
# The default is true
connector.routing.enabled=true
#default:
#connector.routing.default_backend_name=default_backend
connector.routing.default_backend_name=backend_bob
connector.routing.backend-rules[0].link-name=backend_alice
connector.routing.backend-rules[0].match-clause=|(&(equals(ServiceName, 'Test'), equals(FromPartyId, 'gw01')), equals(FromPartyId, 'gw02'))

connector.routing.backend-rules[1].link-name=backend_abc
connector.routing.backend-rules[1].match-clause=|(equals(ServiceName, 'abc'),equals(ServiceType, 'type2'))

connector.routing.backend-rules[2].link-name=backend_abc
connector.routing.backend-rules[2].match-clause=|(equals(ServiceName, 'abc1'),equals(ServiceType, 'type2'))

connector.routing.backend-rules[3].link-name=backend_xyz
connector.routing.backend-rules[3].match-clause=&(startswith(ServiceName, 'zu'),equals(ServiceType, 'type2'))

#connector test rule...
#connector.routing.backend-rules[3].link-name=default_test_backend
#connector.routing.backend-rules[3].match-clause=&(equals(ServiceName, 'Connector-TEST'),equals(ServiceType, 'urn:e-codex:services:'))


#
#
#
##################################################################################
############################ EVIDENCES TOOLKIT ###################################
##################################################################################

# All timeout values apply the following rules:
# -- Set to 0, they will be ignored
# -- After a message is rejected, also a positive received evidence afterwards does not change the status.
# -- All values can be defined as h hours, m minutes, s seconds, ms milliseconds

# boolean value to turn on/off the check if evidences for outgoing messages have been received yet.
connector.controller.evidence.timeoutActive=true
# How often should the timeout of an evidence be checked
# The default is every hour the messages are checked for timed out evidences
connector.controller.evidence.checkTimeout=1m
# After this period, if an outgoing message was sent to the gateway successfully and no RelayREMMD evidence was received,
# a RelayREMMDRejection will be created for this evidence an sent back to the national system.
connector.controller.evidence.relayREMMDTimeout=10m
# After this period, if an outgoing message was sent to the gateway successfully and no Delivery/Non-Delivery evidence was received,
# a Non-Delivery will be created for this evidence an sent back to the national system.
connector.controller.evidence.deliveryTimeout=15m
# After this period, if an outgoing message was sent to the gateway successfully and no Retrieval/Non-Retrieval evidence was received,
# a Non-Retrieval will be created for this evidence an sent back to the national system.
connector.controller.evidence.retrievalTimeout=15m

# This property should show the EXTERNAL address where the gateway can be reached. Should match the address published with the pmodes.
#obviously does not make match sense in this testlab environment
gateway.endpoint.address=http://gw/domibus/services/msh

#This is the name of your Gateway. This should match the PartyID within the pmodes.
gateway.name=GW

# Address data for the generating of the evidences.
postal.address.street=Teststreet 1
postal.address.locality=Testcity
postal.address.zip-code=12345
postal.address.country=AT


##################################################################################
############################ DSS TOOLKIT #########################################
##################################################################################

connector.dss.tl-cache-location=file:./data/tlcache

#connector.dss.trust-list-sources.eu.lotl-sources[0].lotl-url=https://ec.europa.eu/tools/lotl/eu-lotl.xml
#connector.dss.trust-list-sources.eu.lotl-sources[0].signing-certificates-announcement-uri=https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=uriserv:OJ.C_.2019.276.01.0001.01.ENG
#connector.dss.trust-list-sources.eu.lotl-sources[0].pivot-support=true

# connector.dss.trust-list-sources.eu.lotl-sources[0].lotl-url=https://esignature.ec.europa.eu/intl-comp/tl/lotl.xml
# connector.dss.trust-list-sources.eu.lotl-sources[0].signing-certificates-announcement-uri=https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=uriserv:OJ.C_.2019.276.01.0001.01.ENG
# connector.dss.trust-list-sources.eu.lotl-sources[0].pivot-support=true
#  connector.dss.trust-source.eu.lotl-sources[0].signing-certs.

connector.dss.time-stamp-servers.t1.url=http://dss.nowina.lu/pki-factory/tsa/good-tsa
connector.dss.time-stamp-servers.ee-good-tsa.url=http://dss.nowina.lu/pki-factory/tsa/ee-good-tsa

##################################################################################
############################ SECURITY TOOLKIT ####################################
##################################################################################
# Settings for the security library for generating the Token.
# token.issuer.country=AT
# token.issuer.service-provider=TestProvider
# # This can rather be SIGNATURE_BASED, then the main document needs to be signed, or AUTHENTICATION_BASED, in that case the security interface needs
# # to be implemented (see connector.security.toolkit.implementation.class.name)
# token.issuer.advanced-electronic-system-type=AUTHENTICATION_BASED

# token.issuer.identity-provider=Test Identity provider

# # The connectors security lib is loading trusted lists over
# # the network:

# security.lotl.scheme.uri=https://ec.europa.eu/information_society/policy/esignature/trusted-list/tl.html
# security.lotl.url=https://ec.europa.eu/information_society/policy/esignature/trusted-list/tl-mp.xml
# security.oj.url=http://eur-lex.europa.eu/legal-content/EN/TXT/?uri=uriserv:OJ.C_.2016.233.01.0001.01.ENG


# connector.security.oj-store.password=12345
# connector.security.oj-store.path=file:config/keystores/ojstore.jks

connector.ecodex-container.signature-validation.trust-store.path=file:config/keystores/connector-ecodex-truststore.jks
connector.ecodex-container.signature-validation.trust-store.password=12345
connector.ecodex-container.signature-validation.validation-constraints-xml=classpath:/102853/constraint.xml

connector.ecodex-container.signature.keystore.path=file:config/keystores/connector-ecodex-keystore.jks
connector.ecodex-container.signature.keystore.password=12345
connector.ecodex-container.signature.private-key.alias=connector05
connector.ecodex-container.signature.private-key.password=12345


connector.business-document-sent.service-provider=Test Provider
connector.business-document-sent.country=AT
connector.business-document-sent.default-advanced-system-type=SIGNATURE_BASED
connector.business-document-sent.signature-validation.trust-store.path=file:config/keystores/connector-ecodex-truststore.jks
connector.business-document-sent.signature-validation.trust-store.password=12345
connector.business-document-sent.signature-validation.validation-constraints-xml=classpath:/102853/constraint.xml
connector.business-document-sent.authentication-validation.identity-provider=ERV



##################################################################################
############################ JTA CONFIGURATION ###################################
##################################################################################

spring.jta.enabled=true
sprint.jta.log-file=./data/jtalog

###spring.jta.atomikos.datasource.xa-data-source-class-name=org.h2.jdbcx.JdbcDataSource
spring.jta.atomikos.datasource.xa-data-source-class-name=oracle.jdbc.xa.client.OracleXADataSource
spring.jta.atomikos.datasource.max-pool-size=30
spring.jta.atomikos.connectionfactory.max-pool-size=30

##################################################################################
############################ ACTIVMQ CONFIGURATION ###############################
##################################################################################

spring.activemq.broker-url=vm://broker1?brokerConfig=xbean:config/activemq.xml

spring.jpa.hibernate.ddl-auto=none

spring.artemis.mode=embedded
spring.artemis.embedded.enabled=true
spring.artemis.embedded.persistent=true
spring.artemis.embedded.data-directory=./data/artemis/

logging.level.org.apache.activemq.artemis=WARN

##################################################################################
############################ DATASOURCE CONFIGURATION ############################
##################################################################################

# You can just define a spring datasource here or use datasource provided by the container
# Hint: Don't forget to add your jdbc driver jar to your web containers classpath!

# Container defined datasource name:

# JNDI location of the datasource. Class, url, username & password are ignored when set!
#spring.datasource.jndi-name=domibusWebConnectorDS

###### OR ######

# Application defined datasource:

# Fully qualified name of the JDBC driver. Auto-detected based on the URL by default.
# CAUTION !!! USE A XA DRIVER HERE IF spring.jta.enabled is set to TRUE !!!
###spring.datasource.driver-class-name=org.h2.Driver


#non JTA
#spring.datasource.driver-class-name=oracle.jdbc.OracleDriver
#spring.datasource.driver-class-name=oracle.jdbc.xa.client.OracleXADataSource 
#spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

#spring.jta.enabled=false

# JDBC URL of the database.
# example of an embedded H2 datasource
###spring.datasource.url=jdbc:h2:file:./data/connector.db;AUTO_SERVER=TRUE
# 
# example of an oracle datasource
#spring.datasource.url=jdbc:oracle:thin:@sjusee:1521:sjusee
spring.datasource.url=jdbc:oracle:thin:@localhost:4499:XE

# Login username of the database.
###spring.datasource.username=connector
#spring.datasource.username=jueu_ecx_con01_e
spring.datasource.username=system

# Login password of the database.
###spring.datasource.password=connector
#spring.datasource.password=jueu_ecx_con01_e
spring.datasource.password=oracle


## EXPERIMENTAL
########## AUTOMATIC DATABASE INITIALIZATION ########
spring.liquibase.enabled=false
spring.liquibase.change-log=classpath:db/changelog/install.xml
#spring.liquibase.change-log=file:./config/db-scripts/initdb.xml




##################################################################################
############################ BUSINESS MESSAGE CONTENT DELETION ###################
##################################################################################

connector.controller.content.check-timeout-enabled=true
connector.controller.content.check-timeout=1m



##################################################################################
############################ CONTENT STORAGE CONFIGURATION    ####################
##################################################################################

#for filesystem storage
connector.persistence.default-large-file-provider-class=eu.domibus.connector.persistence.largefiles.provider.LargeFilePersistenceServiceFilesystemImpl
#for db storage
#connector.persistence.default-large-file-provider-class=eu.domibus.connector.persistence.largefiles.provider.LargeFilePersistenceServiceJpaImpl

##################################################################################
############################ FILESYSTEM STORAGE CONFIGURATION ####################
##################################################################################

# activate the storage-fs profile and make sure that it is the only activated storage profile!
#
#
connector.persistence.filesystem.storagePath=./data/fsstorage/
#should the directory created recursivly if it does not exists?
connector.persistence.filesystem.createDir=true
#
#EXPERIMENTAL
#should the content of the files be aes encrypted with a random key? key is stored into the database
connector.persistence.filesystem.encryptionActive=false


##################################################################################
############################ INITIAL    CONFIGURATION ############################
##################################################################################


connector.init.user.initialUserPassword=admin
connector.init.user.initialUserName=admin
connector.init.user.initialChangeRequired=false
connector.init.user.logInitialToConsole=true

connector.ui.autoLoginEnabled=true
connector.ui.autoLoginUser=admin
connector.ui.autoLoginPassword=admin
#connector.ui.defaultRoute=configuration/businessDocumentValidation
#connector.ui.defaultRoute=

##################################################################################
############################ BOOTSTRAP  CONFIGURATION ############################
##################################################################################
#
#
#

#
# Fully qualified name of the JDBC driver. Auto-detected based on the URL by default.
#bootstrap.datasource.driver-class-name=com.mysql.cj.jdbc.Driver #mysql driver
bootstrap.datasource.driver-class-name=org.h2.Driver
# JDBC URL of the database.
#embedded H2 datasource...
bootstrap.datasource.url=jdbc:h2:file:./data/connector.db;AUTO_SERVER=TRUE

# Login username of the database.
bootstrap.datasource.username=connector

# Login password of the database.
bootstrap.datasource.password=connector


##################################################################################
############################ LOGGING    CONFIGURATION ############################
##################################################################################

##LOGGING
logging.config=./config/log4j2.xml

#logging.level.eu.domibus.connector.common.spring.BusinessScopedPropertySource=TRACE
#logging.level.eu.domibus.connector.common.spring=TRACE

#set logging level to trace, talks too much on debug
logging.level.eu.domibus.connector.web.configuration.CustomRequestCache=INFO

#set dss tools to trace
#logging.level.eu.europa=TRACE

##################################################################################
############################ OTHER   CONFIGURATION ###############################
##################################################################################

#### embedded tomcat configuration
## will be ignored if deployed on a running tomcat
server.port=8051

spring.jmx.enabled=true
