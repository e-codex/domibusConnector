<?xml version="1.0" encoding="UTF-8"?>
<document>
  <properties>
    <title>Messaging Model</title>
    <author>Hamid Ben Malek</author>
  </properties>
  <body>
    <div class="section"><h3>Holodeck Messaging Model</h3>
      <p>
        The following picture illustrates the Messaging Model used in Holodeck:
        <center><img src="images/messaging-model.png"/></center>
      </p>
      <p>
       For two instances of Holodeck to exchange B2B messages between them, the
       two instances need to agree a one or a set of PMode documents. So at least
        one PMode document is agreed upon and exchanged so that both instances have
        the same copy of the PMode document.  PMode documents are stored in the directory
        "<b>holodeck/config/pmodes/</b>".
      </p>

      <p>
        Once a PMode document has been exchanged between the two instances, message exchange can then start.
        The way the messaging happens will depend on the PMode definition. If for example,
        the PMode definition specifies an MEP as being "<b>One-Way/Push</b>", then one of the two instances
        which plays the sender role will push out a message towards the other instance. Prior to pushing the message,
        a "User" (could be a person, or an application) would have to <b>submit</b> the message first so that
        it will be pushed out to the other remote Holodeck instance. If on the other hand, the MEP
        specified in the PMode definition is a "<b>One-Way/Pull</b>", then the receiver of the message would
        have to pull the message in order to receive it because the other Holodeck instance will not push it out.
        Messages that are pulled out could be already present in the database of the remote Holodeck from
        which they will pulled out, or they could be dynamically constructed once a PullRequest arrives.
      </p>
      <p>
        When a message is submitted to Holodeck, there are always two possibilities:
        either the submitted message will be pushed out (sent) or it will be stored
        in the database until a PullRequest arrives for it and then it is pulled out.
        Whichever the case is determined by the PMode definition. The general rule is that
        when a "<b>User</b>" submits a message, it always tells Holodeck the name of the PMode to
        be associated with the submitted message. Given the name of the PMode, Holodeck figures out what
        to do with the message (send it out, or store it in the database to pull out later when a PullRequest for it arrives)
      </p>
 </div>

<div class="section"><h3>How to submit a message?</h3>
      <p>
        The simplest way to submit a message to Holodeck, is to simply create a new empty folder under
        "<b>holodeck/store/send/</b>" (which you can name anything you want), and inside that empty folder,
        just drop payload data (documents that you want to send out, could be different formats like *.pdf, *.doc, *.txt,
        *.xml, *.jpg, etc... really the documents can be of any type). These payload data are just files of
        different format (could be the same format). But that is not enough. You should tell Holodeck the name
        of the PMode to be associated with the message that will carry on those payload data (the files you placed
        in the newly created empty folder). The way you tell Holodeck about the PMode to use is by simply creating
        in Notepad, a simple xml document that you name "<b>metadata.xml</b>" (which of course you place in the same
        folder that contains your documents). The following is a sample of such xml document:
        <div class="source"><pre>
 &lt;Metadata>
   &lt;pmode>UploadMode&lt;/pmode>
 &lt;/Metadata>
        </pre></div>
 That's all. In the above sample, the PMode being used is called "UploadMode". There are also many optional elements
 that you can specify in the file "<b>metadata.xml</b>". For example, if the PMode being used does not specify
 "<b>&lt;eb:From></b>" party information, then you would have to specify such information. This could be done as in the
 following sample:
 <div class="source"><pre>
 &lt;Metadata>
   &lt;pmode>UploadMode&lt;/pmode>
   &lt;From>
     &lt;PartyId type="corp">fujitsu.com&lt;/PartyId>
     &lt;PartyId type="corp">fla.fujitsu.com&lt;/PartyId>
     &lt;Role>seller&lt;/Role>
   &lt;/From>
 &lt;/Metadata>
        </pre></div>
      </p>

      <p>
       By default, all the files (payload data) that you have dropped in your empty folder (under "<b>holodeck/store/send/</b>")
       will be incorporated in the SOAP message as attachments. If there is among your payload data some
       xml document that you would like to place in the SOAP Body instead, then you have to tell Holodeck" about it.
       The following sample of the file "<b>metadata.xml</b> illustrates this:
 <div class="source"><pre>
 &lt;Metadata>
   &lt;pmode>UploadMode&lt;/pmode>
   &lt;Payloads>
      &lt;BodyPayload>body.xml&lt;/BodyPayload>
   &lt;/Payloads>
 &lt;/Metadata>
        </pre></div>
     As you can see, the above sample tells Holodeck that document called "body.xml" should be placed
     in the SOAP body and not incorporated in the message as an attachment.
      </p>

    <p>
     Also if you like to choose the Mime header cid (Content-ID) that will be used for each of your
    attachments (say because the receiver expects certain attachments with specific names in their Mime CID),
    then you can do that in your "<b>metadata.xml</b>" file as illustrated in the following sample:
  <div class="source"><pre>
 &lt;Metadata>
   &lt;pmode>UploadMode&lt;/pmode>
   &lt;Properties>
      &lt;Property name="price">$40&lt;/Property>
      &lt;Property name="greeting">Hello there&lt;/Property>
   &lt;/Properties>
   &lt;Payloads>
      &lt;BodyPayload>body.xml&lt;/BodyPayload>
      &lt;Payload cid="bradPicture">brad-pitt.jpg&lt;/Payload>
      &lt;Payload cid="geronimo">geronimo.pdf&lt;/Payload>
      &lt;Payload cid="claire">claire-forlani.jpg&lt;/Payload>
      &lt;Payload cid="bear">Bear.wmv&lt;/Payload>
   &lt;/Payloads>
 &lt;/Metadata>
        </pre></div>
    The above example even specifies that two properties should be included in the SOAP header (inside
    the <b>eb:MessageProperties</b> element.
    </p>

    <p>
    If you are far from the machine on which Holodeck is running and you still want to submit
    messages to Holodeck, you can do so over the Internet (over HTTP), by using the Flex interface.
    Just navigate with your browser to the address of the machine where Holodeck is running. The URL
    would be something that looks like this: <b>http://address.of.remote.holodeck:8080/holodeck</b>
    </p>
    </div>
  </body>
</document>
